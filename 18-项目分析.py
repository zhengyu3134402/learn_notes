# == == == == == == == == == == == == == == == == == == == == == == == == == == == == ==
# 乱码（模块乱码待整理）
1
# ??????·???
#
# ????????
#
# ?°??
#
# ???§????    ???·????    ??????????    ???￥????    ????????
#
# ????
#
# ???§?￡??    ???·?￡??    ???????￡??    ???￥?￡??    ?????????￡??
#
# ?????°?????? ·????￡??
#
# 1 ???§?￡??
# ·???×￠??????
# ???§±?
# ???§??
# ????
# ????
# ·???????????
# ???§??
# ????
# ·??????§????????
# ??????
# ???·
# ??±?
# ????·???
# ???????￠
#
# ·???
# ???§±?
# id
# ???§??
# ????
# ????
# ??????
# ???·
# ??±?
# ????·???
# ·???
# 1 ???·
# ???????????§??·????????????????????·????????????????￡????·??????????±???
# ???????????§???????????????·￡????????????????????????·±??????§±????? 1????????
# ???·±?
# id
# ??????
# ???·
# ??±?
# ????·???
# ??·?????
# ???§ID
#
# 2 ????????·???
# ·￠??????????????
#
# ???§±?
# id
# ???§??
# ????
# ????
# ????±???
#
# 3 ?????????????????????￡??
# ???????????§?????????????§
# ???§±?
# id
# ???§??
# ????
# ????
# ????±???
# ????±???
# ×???
#
# ???§±?
# id
# ???§??
# ????
# ????
# ????±???
# ????±???
# ???·±?
# id
# ??????
# ???·
# ??±?
# ????·???
# ??·?????
# ???§ID
# ×???·???
# ??????????????·???￡?????·???
# ??????·????????§???????·￡???±?±?????
#
# 2 ???·?￡??
#
# 1 ???·?×??·???
#
# 2 ???·????????·???
# ???·±?
# ID
# ???·??
# ???·????
# ???·????
# ???·?￥??
# ???·????
# ???·????
# ???·????
# ???·????
# ???·????ID
# ???·????±?
# ID
# ????????
#
# 1 ???·????????·???
# ???????·????????????????
#
# ???·±?
# ID
# ???·??
# ???·????
# ???·????
# ???·?￥??
# ???·????
# ???·????
# ???·????
# ???·????ID
# ???·????±?
# ID
# ???·????
# ???·id
# ???·????±?
# ID
# ????????
# 2 ????????????·???
# ???????????????±￡??????×??????????????????????￡???????????????????￡??????????·??±???±￡??????×???￡???????????￡??????????￥?±??￡?
#
# ???·±?
# ID
# ???·??
# ???·????
# ???·????
# ???·?￥??
# ???·????
# ???·????
# ???·????
# ???·????
# ???·????ID
# ???·????±?
# ID
# ???·????
# ???·id
# ???·????±?
# ID
# ????????
#
#
# 3 ???·????·???
# ?????????????§????????￡?????????×?????·??? ???·±???
#
# ???·±?
# ID
# ???·??
# ???·????
# ???·????
# ???·?￥??
# ???·????
# ???·????
# ???·????
# ???·????ID
# ???·????±?
# ID
# ???·????
# ???·id
# ???·????±?
# ID
# ????????
#
#
# 4 ???·×???·???
# ?????????·?????????±??
# ???????·×???×???
#
# ???·±?
# ID
# ???·??
# ???·????
# ???·????
# ???·?￥??
# ???·????
# ???·????
# ???·????
# ???·×???
# ???·????ID
# ???·????±?
# ID
# ????????
#
# ???·????±?
# ID
# ???·????
# ???·id
# 5 ?×??????·???
# ?????°????????????logo￡?????logo×???￡?????????????????￡?????????×???
# ???·±?
# ID
# ???·??
# ???·????
# ???·????
# ???·?￥??
# ???·????
# ???·????
# ???·????
# ???·×???
# ???·????ID
# ???·????±?
# ID
# ????????
# logo
# ????
# ???·????±?
# ID
# ???·????
# ???·id
# 6
# SKU??SPU????·???
#
# SPU ￡?±?×????·?￥??￡?
# ???·???￠??×????￥??￡? ?????￥??
# ?? iphone7????????SPU￡???????￡?????￡?????￡??×??????????
# SKU(???????￥??)
# ???????????????￥??￡?????????￡???￡????????￥?? ￡????·?????￥??
#
# ???·SKU±?
# ID
# ???·??
# ???·????
# ???·????
# ???·?￥??
# ???·????
# ???·????
# ???·×???
# ???·????ID
# SPU
# ID
#
# ???·SPU±?
# ID
# ????
# ???·????
#
# ???·????±?
# ID
# ????????
# logo
# ????
# ???·????±?
# ID
# ???·????
# ???·SKU
# id
# 7 ·????×?????￥??
#
# ???￥???·±?
# ID
# SKU
# ID
# ????
#
# 1 ???????￥???·????????????
# ????index×???
#
# ???￥???·±?
# ID
# SKU
# ID
# ????
# index
# 8 ·????×??????????????
#
# 1 ????±?
#
# ?×??????????±?
# ID
# ????
# 2 ???÷??????×???????????
# ???? ???????????·×???
#
# ?×??????????±?
# ID
# ????
# ???????·url
# 3 ????????
# ????index
# ?×??????????±?
# ID
# ????
# ???????·url
# index
# 9 ·????×??·??????·??????
#
# ·??????·????±?
#
# id
# SKU
# ID
#
# 1 ????????????
# ????????id
#
# ·??????·????±?
# id
# SKU
# ID
# ????id
#
# 2 ????????
# ????index
#
# ·??????·????±?
# id
# SKU
# ID
# ????id
# index
#
# 3 ????????
# ????????????????????×?￡?????????±???
#
# ·??????·????±?
# id
# SKU
# ID
# ????id
# ????±???
# index
# 10 ???????·????
#
# ???·SKU±???????????
# 1 ???·SKU±?
# ID
# ???·??
# ???·????
# ???·????
# ???·?￥??
# ???·????
# ???·????
# ???·×???
# ????
# ???·????ID
# SPU
# ID
#
# 3 ×???
# 1 ???·SKU±?
# ID
# ???·??
# ???·????
# ???·????
# ???·?￥??
# ???·????
# ???·????
# ???·×???
# ????
# ???·????ID
# SPU
# ID
#
# 2 ???·SPU±?
# ID
# ????
# ???·????
#
# 3 ???·????±?
# ID
# ????????
# logo
# ????
# 4 ???·????±?
# ID
# ???·????
# ???·SKU
# id
#
# 5 ???￥???·±?
# ID
# SKU
# ID
# ????
# index
# 6 ?×??????????±?
# ID
# ????
# ???????·url
# index
# 7 ·??????·????±?
# id
# SKU
# ID
# ????id
# ????±???
# index
# ·???
# °?????·?????±? ????????????????????
# ???￥??±?￡?????????????????
#
# 3 ???????￡??
# ??????×÷??·±￡?????redis??????????????￡?
# ±￡?????§????????????
#
# 4 ???￥?￡??
# ????????·???
#
# ???￥???￠±?
# ???￥id
# ???§id
# ???·id
# ?§??·???
# ×?????
# ×?????
# ??·?
# ?§??×???
# ?????±??
# 1 ???￥?????·?????????????·
#
# ???????￥???￠±?
#
# ???￥???￠±?
# ID
# ???￥ID
# SKU
# ID
# ???·????
# ???·????
#
# 2 ???￥???·????
# ???￥???￠±?
# ID
# ???￥ID
# SKU
# ID
# ???·????
# ???·????
# ????
#
#
# 3 ????????·????????￡????
#
# BaseModel ×??????????￡????
#
# class BaseModel(models.Model):
#     create_time = models.DateTimeField(auto_now_add=True, verbose_name="?????±??")
#     update_time = models.DateTimeField(auto_now=True, verbose_name="?????±??")
#     is_delete = models.BooleanField(default=False, verbose_name="????±???")
#
#     class Meta:
#         abstract = True  # ???÷???????????￡????
#
#
# 1 ???§??
#
# ????????django???????????§????????????·?·?
#
# ???????§?????±????????????￡?AbstractUser, BaseModel￡?:
#
# class User(Abstractuser, BaseModel):
#
#     def generate_active_token(self):
#         serializer = Serializer(settings.SECRET_KEY, 3600)
#         info = {"confim": self.id}
#         token = serializer.dumps(info)
#         return token.decode()
#
#     class Meta:
#         db_table = "df_user"
#         verbose_name = '???§'
#         verbose_name_plural = verbose_name
#
#
# 2 ???·??
#
# class Address(BaseModel):
#     user = models.ForeignKey("User", verbose_name='???????§')
#     receiver = models.CharField(max_length, verbose_name='??????')
#     addr = models.CharField(max_length=256, verbose_name='???????·')
#     zip_code = models.CharField(max_length=6, null=True, verbose_name="????±???")
#     phone = models.CharField(max_length=11, verbose_name="???????°")
#     id_default = models.BooleanField(default=False, verbose_name="??·?????")
#
#     class Meta:
#         db_table = "df_address"
#         verbose_name = '???·'
#         verbose_name_plural = verbose_name
#
#
# 3 ???·?￡??
#
# class GoodType(BaseModel):
#     name = models.CharField(max_length=20, verbose_name="????????")
#     logo = models.CharField(max_length=20￡? vernpse_name = "±???")  # ??±???
#     image = models.ImageField(upload_to='type', verbose_name="???·????????")
#
#     class Meta:
#         db_table = "df_goods_type"
#         verbose_name = '???·????'
#         verbose_name_plural = verbose_name
#
#     def __str__(self):
#         reutrn
#         self.name
#
#
# 4 ???·SPU?￡????
#
# class Goods(BaseModel):
#     name = models.CharField(max_length=20, verbose_name="???·SPU????")
#     detail = HTMLField(blank=True, verbose_name="???·????")  # ????±?????
#
#     class Meta:
#         db_table = "df_goods"
#         verbose_name = "???·SPU"
#         verbose_name_plural = verbose_name
#
#
# 5 ???·SKU?￡????
#
# status_choices = (
#     (0, "????"),
#     (1, "????"),
# )
# type = models.ForeignKey("GoodsType", verbose_name="???·????")
# goods = models.ForeignKey("Goods", verbose_name="???·SPU")
# name = models.CharField(max_length=20, verbose_name="???·????")
# desc = models.CharField(max_length=256, verbose_name="???·????")
# price = models.Decimalfield(max_digits=10, decimal_places=2, verbose_name="???·????")
# unite = models.CharField(max_length=20, verbose_name="???·?￥??")
# image = models.IntegerField(upload_to="goods", verbose_name="???·????")
# stock = models.IntegerField(default=1, verbose_name="???·????")
# sales = models.IntegerField(default=0, verbose_name="???·????")
# status = models.SmallIntegerField(default=1, choices=status_chices,
#                                   verbose_name="???·×???")  # ??????????￡?choice????????·??§
#
#
# class Meta:
#     db_table = "df_goods_sku"
#     verbose_name = "???·"
#     verbose_name_plural = verbose_name
#
#
# 6 ???·?????￡????
#
# class GoodsImage(BaseModel):
#     sku = models.ForeignKey("GoodsSKU", verbose_name="???·")
#     image = models.ImageField(upload_to="goods", verbose_name="?????·??")
#
#     class Meta:
#         db_table = "df_goods_image"
#         verbose_name = "???·????"
#         verbose_name_plural = verbose_name
#
#
# 7 ???￥???￡????
#
# class IndexGoodsBanner(BaseModel):
#     sku = model.ForeignKey("GoodSKU", verbose_name="???·")
#     image = models.ImageField(upload_to="banner", verbose_name="????")
#     index = models.SmallIntegerField(default=0, verbose_name='????????')
#
#     class Meta:
#         db_table = "df_index_banner"
#         verbose_name = "???￥???·????"
#         verbose_name_plural = verbose_name
#
#
# 8 ?????????￡????
#
# ckass
# IndexPromotionBanner(BaseModel):
# name = models.CharField(max_length=20, verbose_name="????????")
# url = models.URLField(verbose_name="????????")
# image = model.ImageField(upload_to="banner", verbose_name="????????")
# index = models.SmallIntegerField(default=0, verbose_name="????????")
#
#
# class Meta:
#     db_table = "df_index_promotion"
#     verbose_name = "????????"
#     verbose_name_plural = verbose_name
#
#
# 9 ·??????·?????￡??
#
# class IndexTypeGoodsBanner(BaseModel):
#     DISPLAY_TYPE_CHOICES = (
#         (0, "±???"),
#         (1, "????")
#     )
#     type = models.ForeignKey('GoodsType', verbose_name="????????")
#     sku = models.ForeignKey('GoodsSKU', verbose_name="???·SKU")
#     display_type = models.SmallIntegerField(default=1
#     n
#     choices = DISPLAY_TYPE_CHOICES, verbose_name = "????????")
#     index = models.SmallIntegerField(default=0, verbose_name="????????"
#
#     class Meta:
#         db_table = "df_index_type_goods"
#         verbose_name = "·??????????·"
#         verbose_name_plural = verbose_name
#
#
# 10 ???￥???￠??
#
# class OrderInfo(BaseModel):
#     PAY_METHOD_CHOICES = (
#         (1, "????????"),
#         (2, "?￠???§??"),
#         (3, "?§??±?"),
#         (4, "?????§??"),
#     )
#
#     ORDER_STATUS_CHOICES = (
#
#         (1, "???§??"),
#         (2, "??·￠??"),
#         (3, "??????"),
#         (4, "??????"),
#         (5, "??????"),
#     )
#
#     order_id = models.CharField(max_length=128, primary_key=True, verbose_name="???￥±???")
#     user = models.ForeignKey("user.User", verbose_name="???§")  # user.User ?????????? app?????????????￠????
#     addr = models.ForeignKey("user.Address", verbose_name="???·")
#     pay_method = models.SmallIntegerField(choices=PAY_METHOD_CHOICES, default=3, verbose_name="?§??·???")
#     total_count = models.IntegerField(default=1, verbose_name="???·????")
#     total_price = models.DecimalField(max_digits=10, decimal_places=2, verbose_name="×???")
#     transit_price = models.DecimalField(max_digits=10, decimal_places=2, verbose_name="??·?")
#     order_status = models.SmallIntegerField(choices=ORDER_STATUS_CHOICES, default=1, varbose_name="?§??×???")
#     trade_no = models.CharField(max_length=128, verbose_name="?§??±???")
#
#     class Meta:
#         db_table = "df_order_info"
#
#
# 11 ???￥???·?￡??
#
# order = models.ForeignKey("OrderInfo", verbose_name="???￥")
# sku = models.ForeignKey("goods.goodsSKU", verbose_name="???·????SKU")
# count = models.IntegerField(default=1, verbose_name="???·????")
# price = models.DecimalField(max_digits=10, decimal_places=2, verbose_name="???·????")
# comment = models.CharField(max_length=256, verbose_name="????")
#
#
# class Meta:
#     db_table = "df_order_goods"
#
# == == == == == == == == == == == == == == == == == == == == == == == == == == == == ==
#
# == == == == == == == == == == == == == == == == == == == == == == == == == == == == == =
# ????????×???·???????model
# ???§?????????· ???????·?￡?? ?????????§
# ????md5????????·??? ???￠???§???? max_length = 64
# 1 ???§?￡??
#
#
# 3 ???§????
# ???§???????￠??
#
# ???????????§?????￠??￡?
# °??????§??￡????°?????·￡????±??????·??????????§×????????????·???￠
# ￡????§×??????????·???￠￡??°?????????????????￠url?·??×???10?????·￡?
#
# ???§???????￥??￡?
# ???????????§?????￥???￠
#
# 4 ????
# ???????§????????￡??????￥?????????????§?????￠
#
#
# 2 ???·?￡??
#
# 1 ?×??
# ?????????×?????￥???·???￠
# ?????????×?????????￠
# ???????????·?????????￠?￠????
# ?????????×?????????????????????·￡?°??????????·????×????·￡?
# ???÷?????????·?±??×??????·??????????
# 2 ???·??????
#
# ????×???·????????????????·??2?????·???￠
#
# 3 ???·??±???
#
# ???????????????·????±?????￡?·????????￠?§??????￡?????￡?????????
# ??????×???·????????????????·??2?????·???￠
#
# 4 ????
# ???????????÷?????÷???·???￠
#
#
# 3 ??????????
#
# @ @ @ @ @ @ @ @ @ @ @
#
# ??±????????????????·????????????(???????????·)
# ???§??????￡??×??￡???????￡???±??????????????§???????????·??????
# ??????????
# ?????§?????????????·??×÷￡??????????????·￡??????????????????????·??????
#
# == == == == == == == == == == == == == == == == == == == == == == == == == == == == == =
#
# -i
# https: // pypi.douban.com / simple
# 1 ???§?￡??
#
# ?￡??User
# ???§??username
# ????password
# ????email
# ????is_actice
# ???°phone
# ???§?????????·mangytomany(Commodity)
# ???§???￥onetomany￡?Order￡?
#
# ?￡??Address
# address = Foreignkey(user)
#
# 2 ???·?￡??
#
# ?￡??Commodity
# ???·??name
# ???·???￠info
# ???·????price
# ????????inventory
# ????photo  ￡?URLField￡?
# ?￡??Kind
# ??????×?title
# ???·commodity
# Foreignkey
#
# 3 ???????￡??
#
# ?￡??Order
# ???????????·interested_Com
# ???????·??×???total_price
# ???????·??×?????total_nums
# ?????????·buy_coms
# ??·??§?? is_pay
#
# ????·???
# 1 ???§?￡??
#
# 1 ×￠????
# ×￠???±?￡?????§????·???±?×￠??
# ￡?????????°??￥￡????÷°??￥·??????§????·?????±?×￠??￡?
# ???????§???￠??×￠??
# ?????§??×￠??????·￠??????￡????§???÷???????????????????????§???§??????
# ￡?????itsdangerous????????????￡??￠????￡?????·￠??????￡?
#
# 2 ??????
# ???????§??????????
# ￡?1 ????token??????·??????????§??·?????￡?
# 2 ?????????§?????§??????token???￠??????????????uuid????token￡?·????????§
# 3 ???§·￠??????????????????????￡?????token·￠????????￡???????????·?????????????token????
# ?????????§??·???????×????￠????·???±???
# 4 ????????????????????￡????§????·??????°??token????￡??????§??token??????????????????￡?
#
#
# 3 ???§????
# ???§???????￠??
# ￡????????§???????? ??????
# 1 ???????·???????§??username ?? token
# 2 ????username??redis??????token???????·????token????????
# ????????????????????￡????????????§°?￡?
# ???????????§?????￠??￡?
# °??????§??￡????°?????·￡????±??????·??????????§×????????????·???￠
# ￡????§×??????????·???￠￡??°?????????????????￠url?·??×???10?????·￡?
# ???§???????·??￡?
# ???????????§?????????????·￡? ??????·???±??￥???????????§?????????·
# ???§???????￥??￡?
# ???????????§?????￥???￠
# 4 ????
# ???????§????????￡??????￥?????????????§?????￠
#
# 2 ???·?￡??
# ￡????????§?????????·??????????￡????????§?????????????·??????????￡?
# ￡????????·????????????￡????????§????·???￡?
# 1 ?×??
# ?????????×?????￥???·???￠
# ?????????×?????????￠
# ???????????·?????????￠?￠????
# ?????????×?????????????????????·￡?°??????????·????×????·￡?
# ???÷?????????·?±??×??????·??????????
# 2 ???·??????
# ?????????????·?????????￠
# ????×???·????????????????·??2?????·???￠
#
# 3 ???·??±???
# ???????????????·????±?????￡?·????????￠?§??????￡?????￡?????????
# ??????×???·????????????????·??2?????·???￠
#
# 4 ????
# ???????????÷?????÷???·???￠
#
# 3 ??????????
#
# ??±????????????????·????????????
# ???§??????￡??×??￡???????￡???±??????????????§???????????·??????
# ??????????
# ?????§?????????????·??×÷￡??????????????·￡??????????????????????·??????
#
# 4 ???￥????
# ???????￥????￡????????§×?±??????????·???￠
# ???÷???????￥???????￥??????
# ???§?????￥?????????§?????￥???￠
# ???÷?§?????????￥?§??
#
#
#
#
#
#
#
1
# django choice字段的使用
1
#
#     限定选择范围,在页面中是选择标签
#
#     class A(models.Model):
#         a = (
#             (0,"a"),
#             (1, "b")
#         )
#
#     b = models.SmallIntegerField(choice=a)
#
#
1
# django 富文本编辑器
1
#     能够像office一样编写出漂亮的文字页面
#
#     1 安装
#         pip3 install django-tinymce
#
#     2 注册
#         应用注册
#             "tinymce"
#
#     3 配置富文编辑器
#         1 settings中
#             TINYMCE_DEFAULT_CONFIG = {
#                 'theme': 'advanced',  # 高级主题功能多
#                 'width': 600,
#                 'height': 400,
#             }
#
#         2 url.py中
#
#             url(r'tinymce/', include('tinymce.urls')),
#
#     4 使用
#         模型类中
#             from tinymce.models import HTMLField
#             class A(models.Model):
#                 s = HTMLField()
#
# django类型中verbose_name和verbose_name_plural
#
#     成套使用 admin后台管理系统中模型类会显示指定的中文
#     verbose_name = "商品"
#     verbose_name_plural = verbose_name
1

# 4 项目框架的搭建
1
#
#     1 应用配置
#
#         所有应用发到1个apps目录中
#
#             选择1
#
#                 1 注册应用
#                         'apps.应用名'
#                 2 配置路由
#                         模块url放前面，主页url方在最后
#                         url(r'^user/', include('apps.user.urls'))
#
#             选择2
#
#                 settings中添加(即添加了django的搜索路径)
#                     sys.path.insert(0, os.path.join(BASE_DIR, 'app'))
#                 照常--
#                 1 注册应用
#                     '应用名'
#                 2 配置路由
#                     模块url放前面，主页url方在最后
#                     url(r'^user/', include('user.urls'))
#
#     2 定义模型抽象基类
#
#         1 创建目录db
#         2 db中创建base_model.py文件
#             class BaseModel(models.Model):
#                 """模型抽象基类"""
#                 create_time = models.DateTimeField(auto_now_add=True, verbose_name="创建时间")
#                 update_time = models.DateTimeField(auto_now=True, verbose_name="修改时间")
#                 is_delete = models.BooleanField(default=False, verbose_name="删除标记")
#
#                 class Meta:
#                     abstract = True  # 指定说明是一个抽象说明类
#
#     3 把写好的模型类添加到各自类中
#
#     4 指定django认证系统使用的模型类
#         指定之后就不会生产原来的默认表auth_user等
#
#         settings中
#
#             AUTH_USER_MODEL = 'user.User'
#
#
1


# 1 注册逻辑
1
#     1 写视图函数 返回对应 html
#         配置 html 文件引入
#         配置 表单action
#
#         处理函数的一般步骤
#             1 接收数据
#                 username = request.POST.get("username")
#                 password = request.POST.get("pwd")
#                 email = request.POST.get("email")
#                 alloww = request.POST.get("allow")
#
#             2 对数据进行校验
#
#                 校验数据是否含有空
#                 if not all([username, password,email]):
#                     return render(xx)
#
#                 校验邮箱
#                 if not re.match(xx, email)
#                     return render(xx)
#
#                 检验是否同意
#                 if allow != 'on':
#                     return render(xx)
#
#                 校验用户名是否重复
#                 try:
#                     User.objects.get(username=username)
#                 except User.DoesNotExist:
#                     user = None
#                 if user:
#                     return render(xx, {"errmsg":"用户名已存在"})
#
#             3 进行业务处理
#
#                 User.objects.create_user(username, email, password)_
#
#
#             4 发送激活邮件，包含激活链接
#
#                 激活链接中需要包含用户的身份信息，并且把身份信息进行加密
#                 使用itsdangerous
#
#                 加密用户什么信息
#                     serializer = TimewebJson...(settings.SECRET_KEY, 3600)
#                     info = {'confirm':user.id}
#                     token = serializer.dumps{info}.decode("utf8") #
#
#                 发送邮件
#                     发送邮件流程
#                         网站发送邮件-->smtp服务器-->目的邮箱
#                     配置发送邮件(163服务地址)
#                         EMAIL_BACKEND = "django.core.mail.backends.smtp.EmailBackend"
#                         EMAIL_HOST = 'smtp.163.com'
#                         EMAIL_PORT = 25
#                         EMAIL_HOST_USER = '发送邮件的邮箱'
#                         EMAIL_HOST_PASSWORD = '授权码'
#                         EMAIL_FROM = '收件人看到的发件人同EMAIL_HOST_USERS值相同' # 可写成xx<xx@163.com>
#
#                     发邮件（别忘了异步发送邮箱工具celery）
#                         subject = '主题'
#                         message =''
#                         sender = settings.EMAIL_FROM
#                         receiver = ["接收人的邮箱"]
#                         # 如果发送的信息中含有html标签
#                         html_message = '<h1>%s,欢迎</h1>请点击链接激活账户<br><a href="http://127.0.0.1:8000/user/active/%s">http://127.0.0.1:8000/user/active/%s</a>'%(username, token, token)
#                         send_mail(subject, message, sender, receiver, html_message=html_message)
#
#             5 返回应答, 跳转首页
#
#                 return redirect(reverse('good:index'))
#
#
#     2 使用类视图
#         类视图的原理
#             用dispatch方法分发调用 类中的对应的get，post或其他方法
#
#     3 激活视图
#         class Active(View):
#             def get(self, request, token):
#
#                 serializer = TimewebJson...(settings.SECRET_KEY, 3600)
#                 try:
#                     info = serializer.loads(token)
#                     user_id = info['confirm']
#
#                     user = User.objects.get(id=user_id)
#                     user.is_active = 1
#                     user.save()
#
#                     return 返回登录页面
#
#                 except SignatureExpired:
#                     # 激活链接过期，实际提示又发送了一个激活邮件请点击
#                     return HttpResponse('xxx')
1


# 2 登录逻辑
1
    # 1 登录校验流程

        # from django.contrib.auth import authenticate, login
        # class LoginView(View):
        #
        #     def get(self, request):
        #         判断是否记住了用户名
        #         if 'username' in request.COOKIES:
        #             username = request.COOKIES.get('username')
        #             checked = 'checked'
        #         else:
        #             username = ''
        #             checked = ''
        #         return render(request, 'xx.html', {"username":username, 'check':checked})

        #
        #     def post(self, request):
        #         """登录校验"""

        #
        #         接收数据
        #         username = request.POST.get("username")
        #         password = request.POST.get("pwd")
        #
        #         校验数据
        #         if not all([username, password]):
        #             return render(xxxx)
        #
        #         业务处理:登录校验
        #
        #         user = authenticate(username=username, password=password)
        #         if user is not None:
        #             if user.is_active:
        #                 print("用户已经激活")
        #
        #                 记录登录状态
        #                 login(request, user)
        #                 return redirect(xx)
        #                 获取登录后所要跳转的地址
        #                 next_url = request.GET.get('next', reverse(xx)) # 如果获取不到 设置默认值
        #                 response = redirect(next_url)
        #                 判断是否需要记住用户名
        #                 remember = request.POST.get('remember')
        #                 if remember == 'on':
        #                     response.set_cookie('username', username, max_age=7*24*3600)
        #                 else:
        #                     response.delete_cookie('username')
        #                 return response
        #
        #             else:
        #                 # 用户名密码错误
        #                 return '用户未激活'
        #         else:
        #             return '用户名或密码错误'

    # 2 使用redis存储session信息

        # 方式1
        #     1 安装
        #         pip3 install django-redis-session
        #
        #     2 配置
        #
        #         SESSION_ENGINE = "redis_sessions.session"
        #         SESSION_REDIS_HOST = "localhost"
        #         SESSION_REDIS_PORT = 6379
        #         SESSION_REDIS_DB = 2
        #         SESSION_REDIS_PASSWORD = ''
        #         SESSION_REDIS_PREFIX = 'session'
        #
        #     3 使用
        #         def test(request):
        #             request.session['h1'] = 'hello'
        #             a = reuquest.session.get('h1')
        #             del request.session['h1']
        #             request.session.flush()
        # 方式2
        #
        #     django-redis 使django支持Redis cache/session后端的全功能支持
        #
        #     1 安装
        #         pip3 install django-redis
        #
        #     2 配置
        #
        #
        #             django的配置缓存
        #
        #                 CACHES = {
        #                     "default":{
        #                         "BACKEND":'django_redis.cache.RedisCache',
        #                         "LOCATION": 'redis://127.0.0.1:6379/1',
        #                         "OPTIONS": {
        #                                 "CLIENT_CLASS":"django_redis".clent.DefaultClient,
        #                             }
        #                         }
        #                     }
        #
        #             配置为sesshon存储
        #
        #                 SESSION_ENGINE = "django.contrib.sessions.backends.cache"
        #                 SESSION_CACHE_ALIAS = "default"
        #
1

# 3 抽离父模板

# 4 登录装饰器和登录后页面跳转
1
    # 1 配置未登录后的的自动跳转地址
    #
    #     LOGIN_URL = '/XX/XXXX'
    #     注意
    #         前段表单不要设置action属性
    #         因为默认提交地址就是当前页地址
    #         如果设置了action, 获取next参数的时候会出现问题
    # 2 判断用户是否登录
    #
    #     创建类重写as_view方法类判断用户是否登录
    #         from django.contrib.auth.decorators import login_required
    #
    #         class A:
    #             @classmethod
    #             def as_view(cls, **initkwargs):
    #                 view = super(A, cls).as_view(**initkwargs)
    #                 return login_required(view)
    #
    #
    #         视图的使用
    #
    #             class B(A, view):
    #                 .....
1
# 5 登录后欢迎信息
1
    # is_authenticated() # 除了给模板文件传递的模板变量之外，django框架会吧request.user也传递给模板文件
    # 后端中判断
    # def get(self, request):
    #     # 如果登录a为True(request.user为User类一个实例) 否则False（request.user为AnonymousUser一个实例）
    #     a = request.user.is_authenticated()
    # 前段中判断
    #     {% if user.is_authenticated %}
    #         xxx
    #     {% else %}
    #         yyy
    #     {% end %}
1
# 6 退出登录
1
#     from django.contrib.auth.decorators import login_out
#     class LogutView(View):
#
#         def get(self, request):
#
#             清除session信息
#             logout(request)
#
#             跳转到首页
#             return redirect(xxx)
#
1
# 7 用户中心信息页
1
    # class UserInfo(xx):
    #     def get(self, request):
    #
    #     获取用户的个人信息
    #     user = request.user
    #     address = Address.objects.get_default_address(user) # 模型类管理器
    #
    #     获取用户历史浏览记录
    #     创建redis操作对象的方式二
    #     from django_redis import get_redis_connection
    #     con = get_redis_connection('default')
    #     history_key = 'history_%d'%user.id
    #
    #
    #     获取用户最新浏览的5个商品id
    #     sku_ids = con.lrage(history_key, 0 ,4)
    #
    #     从数据空中查询用户浏览的商品的具体信息(通过redis获取到浏览商品的列表商品id的顺序,
    #                         去数据库中获取商品返回的顺序不一样)
    #     goods_li = []
    #     for id in sku_ids:
    #         goods = GoodsSKU.object.get(id=id)
    #         goods_li.append(goods)
    #
    #     return rendr(xxxxx)
1

# 8 用户中心订单页
1
    # 获取用户订单信息
    #
1
# 9 用户中心地址页
1
#     class AddressView(View):
#
#         def get(self,request):
#
#             获取用户默认收货地址
#             user = request.user
#
#             try:
#                 address = Address.objects.get(user=user, is_default=True)
#
#             except Address.DoesNotExist:
#                 不存在默认收货地址
#                 address = None
#
#             return render(xxx,{"default_addr":address})
#
#         def post(self,request):
#             接收数据
#             receiver = request.POST.get('receiver')
#             addr = request.POST.get('addr')
#             zip_code = request.POST.get('zip_code')
#             phone = request.POST.get('phone')
#             校验数据
#             if not all([receiver, addr, phone]):
#                 return render '数据不完整'
#
#             校验手机号
#             re.match(r'xxxx', phone)
#                 return render '手机格式不正确'
#             业务处理: 地址添加
#             如果用户已存在默认收货地址, 添加的地址不作为默认收货地址，否则默认收货地址
#
#             user = request.user
#
#             address = Address.objects.get_default_address(user) # 使用了模型管理器类
#             if address:
#                 is_default = False
#             else:
#                 is_default = True
#
#             Address.objects.create(user=user, receiver=receiver,
#                                    addr=address,zip_code=zip_code,
#                                    phone=phone,
#                                    is_default=is_default)
#
#
#             返回应答 刷新地址页面
#             return redirect(reverse('user:address'))
#
1
# 10 模型类管理器类
1
#     自定义管理器
#     models文件中（视图函数中存在了相同的查询方法，使用模型管理器类，进行封装）
#
#         class xxManager(model.Manager):
#
#             作用
#                 1 改变原有查询的结果集all()
#                 2 封装方法 用户操作模型类对应的数据表(增删改查)
#
#             获取用户默认地址
#             def get_defautl_address(self, user):
#                 # self.model 获取self对象所在的模型类
#                 try:
#                     address = self.get(user=user, is_default=True)
#
#                 except self.model.DoesNotExist:
#                     不存在默认收货地址
#                     address = None
#
#                 return address
1

# 11 获取用户的历史浏览记录
1
#     1 访问商品详情页面的时候添加浏览记录,在商品详情对应的视图中
#     2 访问用户中心个人信息的时候获取历史浏览记录
#     3 历史浏览记录存储在redis数据库
#     4 redis中粗出历史浏览记录的格式
#         每个用户的历史浏览记录用一条数据保存
#         list:
#             history_用户id:[2,3,1]
#         添加历史浏览记录时, 用户最新浏览的商品的id从列表左侧插入
1

# 12 分布式图片服务器FastDFS

    # 1 介绍
    1
    #
    #     用c语言编写的一款开源的分布式文件系统
    #     提供文件上传和下载的服务
    #     架构包括 Tracker server 和Strorage server
    #         Tracker server进行文件上传, 下载 调度作用
    #         Tracker server 通过调度最终由Strorage server
    #         完成文件上传和下载, 文件存储作用
    #
    #     优点
    #         海量存储, 存储容量扩展方便
    #         文件内容重复, 只保存一份
    #         结合nginx提高网站提供图片的效率
    1
    # 1.1 流程
    1
    #     通过admin页面上传图片-->django服务器-->把文件上传到fast dfs文件存储服务器
    #
    #                         保存在django对应表中<--返回文件id<--
    #     用户请求图片 -->django服务器渲染页面<img src="http:xx.xx.xxx.xx/文件id">
    #             返回给浏览器<--nginx去FDFS文件存储服务器中获取文件--浏览器根据地址请求nginx<--返回给浏览器<--
    1
    # 2 安装和配置
    1
    #
    #     linux安装
    #
    #         1 安装fastdfs依赖包
    #             1解压缩libfastcommon-master.zip
    #             2进入libfastcommon-master目录
    #             3执行 ./make.sh
    #             4执行sudo ./make.sh install
    #
    #         2 安装fastdjs
    #             1 接压缩fastdfs-master.zip
    #             2 进入到 fastdfs-master 目录中
    #             3 执行./make.sh
    #             4 执行sudo ./make.sh install
    #
    #         3 配置跟踪服务器tracker
    #             1 sudo cp /ect/fdfs/tracker.conf.sample /ect/fdfs/tracker.conf
    #             2 在/home/python/目录中创建目录 fastdfs/tracker
    #
    #                 mkdir -p /home/python/fastdfs/tracker
    #             3 编辑/ect/fdfs/tracker.conf配置文件
    #                 sudo vim /etc/fdfs/tracker.conf
    #                 修改 base_path=/home/python/fastdfs/tracker
    #
    #         4 配置存储服务器storage
    #
    #             1 sudo cp /ect/fdfs/storage.conf.sample /ect/fdfs/storage.conf
    #             2 在/home/python/fastdfs/ 目录中创建目录 storage
    #                 mkdir -p /home/python/fastdfs/storage
    #             3 编辑/etc/fdfs/storage.conf配置文件
    #                 sudo vim /ect/fdfs/storage.conf
    #                 修改内容 base_path=/home/python/fastdfs/storage
    #                         store_path0=/home/python/fastdfs/storage
    #                         tracker_server = 自娱Ubuntu虚拟机的ip地址:22122
    #         5 启动tracker和storage
    #             sudo service fdfs_trackerd start
    #             sudo service fdfs_storaged start
    #
    #         6 测试
    #             1 sudo cp/etc/fdfs/client.conf.sample /etc/fdfs/client.conf
    #             2 编辑/ect/fdfs/client.conf配置文件
    #                 sudo vim /etc/fdfs/client.conf
    #
    #                 修改
    #                     base_path=/home/python/fastdfs/tracker
    #                     tracker_server=自己ubuntu虚拟机的ip地址22122
    #             3 上传文件测试
    #                 fdfs_upload_file /etc/fdfs/client.conf 要上传的图片文件
    #                 如果返回类似 group1/Mod/00/00/fsdgfddhshsdhsdhssd.jpg 说明成功
    1
    # 3 Nginx配合FastDFS使用安装和配置
    1
    #     解决FastDFS用户量比较大的问题借助Nginx
    #
    #     1 安装nginx和fastdfs-nginx-module
    #
    #         1 解压缩 nginx-1.8.1   # web 服务器 epoll
    #         2 解压缩 fastdfs-nginx-module-master.zip
    #         3 进入nginx-1.8.1目录中
    #         4 执行
    #             sudo ./configure --prefix=/usr/local/nginx/ --add-module-fastdfs-nginx-module-master解压
    #                 后的目录的绝对路径/src
    #
    #             sudo ./make
    #             sudo ./make install
    #
    #             sudo cp fastdfs-nginx-module-master 解压后的目录中src下的
    #                 mod_fastdfs.conf /etc/fdfs/mod_fastdfs.conf
    #
    #             sudo vim /etc/fdfs/mod_fastdfs.conf
    #                 修改内容
    #                     connect_timeout=10
    #                     tracker_server=自己ubuntu虚拟机ip地址:22122
    #                     url_have_group_name=true
    #                     store_path0=/home/python/fastdfs/storage
    #
    #             sudo cp 解压缩的fastdfs-master目录conf目录中的http.conf /etc/fdfs/http.conf
    #
    #             sudo cp 解压缩的fastdfs-master目录conf目录中的mine.types /etc/fdfs/mime.types
    #
    #             sudo vim /user/local/nginx/conf/nginx.conf
    #                 在http部分中添加配置信息:
    #                     server{
    #                         listen  8888;
    #                         server_name  localhost;
    #                         location ~/group[0-9]/{
    #                             ngx_fastdfs_module;
    #                         }
    #                         error_page 500 502 503 504 /50x.html;
    #                         location = /50x.html{
    #                             root html;
    #                         }
    #                     }
    #         5 启动nginx
    #             sudo /usr/local/nginx/sbin/nginx
    #
    1
    # 4 使用python客户端上传测试
    1
    #     1 安装依赖包
    #         先下载源码包fdfs_client-py-master.zip
    #         进入包所在目录 pip install fdfs_client-py-master.zip
    #
    #     2 上传文件
    #         from fdfs_client.client import Fdfs_client
    #         client = Fdfs_client("/ect/fdfs/client.conf") # 参数为client.conf文件所在路径
    #         ret = client.upload_by_filename('test')
    #         ret返回值 会返回来
    #                 {
    #                   'Group name':'xx', 'Status':'Upload successed', 'Remote file_id':'xxx',
    #                   ........
    #                 }
    #
    1
    # 5 修改django的上传行为(即将原本文件存储路径存到FastDFS中)
    1
        # 1 自定义文件存储类
        # from django.core.files.storage import Storage
        # from fdfs_client.client import Fdfs_client
        #
        # class A(Storage):
        #
        #     def __init__(self, client_conf=None, base_url=None):
        #         """为了动态配置文件路径，
        #             和返回的文件路径
        #
        #         """
        #         if client_conf is None:
        #             client_conf = 'client.conf的相对项目路径'
        #         self.client_conf = client_conf
        #
        #         if base_url is None :
        #             base_url = 'http://127.0.0.1:80000'
        #         self.base_url = base_url
        #
        #
        #
        #     def _open(self, name, mode='rb'):
        #         """打开文件时使用"""
        #         pass
        #
        #     def _save(self, name, content):
        #         """
        #         保存文件时使用
        #         参数：
        #             name 上传文件的名字
        #             content 包含上传文件内容file类的对象
        #         """
        #
        #         # 创建一个Fdfs_client对象
        #         # 参数需要指定配置文件
        #             # 需要client.conf配置文件放在此类文件的同目录下
        #             #     修改 base_path = /xx/  记录日志路径
        #             #         tacker_server=xxxx
        #         client = Fdfs_client(self.client_conf)
        #
        #         # 上传文件到fast dfs系统中, 根据文件内容上传文件
        #         res = client.upload_by_buffer(content.read())
        #
        #         if res.get('Status') != 'Upload successed':
        #             # 上传失败
        #             raise  Exception('删除文件fast dfs失败')
        #         # 获取返回的文件id
        #         filename = res.get('Remote file_id')
        #
        #         return filename
        #
        #     def exists(self, name):
        #         """django判断文件名是否可用
        #             因为上传的是fastdfs,不存在文件名不可用
        #         """
        #         return False
        #
        #     def url(self, name):
        #         """返回范根文件的url路径"""
        #         return self.base_url+name
        #
        #
        # 2 让django使用自定义的存储类
        #
        #     settings中
        #         DEFAULT_FILE_STORAGE='自定义类的路径'
    1
# 13 网站首页生成静态页面
    1
    # 1作用
    #     对于不经常改变的网页而言,减轻服务器查询数据库压力
    #
    # 2使用工具和考虑条件
    #     首页页面的静态化
    #         使用工具
    #             celery
    #         重新生成条件
    #             当管理员后台修改首页数据的时候, 需要重新生成首页静态页面
    #
    # 3定义任务函数
    #     from django.template import loader, RequestContext
    #
    #     @app.task
    #     def a():
    #         # 查询首页需要的数据
    #
    #         context = {xx:xxx}
    #         1 加载模板文件, 返回模板对象
    #             temp = loader.get_template('xx.html')
    #
    #         2 渲染模板
    #             static_index_html = temp.render(context)
    #
    #         3 生成首页对应的静态文件
    #             save_path = os.path.join(settings.BASE_DIR, 'static/index.html')
    #             with open(save_path, 'w') as f:
    #                 f.write(static_index_html)
    #
    # 4配置nginx提交静态页面
    #
    #     server{
    #         listen  80;
    #         server_name  localhost;
    #         location /static {
    #             xxxx
    #         }
    #         location / {
    #             root 路径
    #             index index.html index.htm
    #         }
    #     }
    #
    # 5 后台管理员更新首页数据时重新生产静态页面
    #
    #     class A(admin.ModelAdmin):
    #         def save_model(self, request, obj, form, change):
    #             """新增或更新表中的数据时调用"""
    #             super().save_model(request, obj, form, change)
    #
    #             # 发出任务, 让celery 重新生产首页静态页面
    #             xx.delay()
    #
    #         def delete_model(self, request, obj):
    #             super().delete_model(request, obj)
    #
    #             # 发出任务, 让celery 重新生产首页静态页面
    #             xx.delay()
    #
    #     admin.site.register(xx, A)
    #
    # 6 由于有多个类所以抽象基类
    #
    #
    #     class Base_A(admin.ModelAdmin):
    #         def save_model(self, request, obj, form, change):
    #             """新增或更新表中的数据时调用"""
    #             super().save_model(request, obj, form, change)
    #
    #             # 发出任务, 让celery 重新生产首页静态页面
    #             xx.delay()
    #
    #         def delete_model(self, request, obj):
    #             super().delete_model(request, obj)
    #
    #             # 发出任务, 让celery 重新生产首页静态页面
    #             xx.delay()
    #
    #     class A(Base_A):
    #         pass
    #
    #     class B(Base_A):
    #         pass
    #     ...
    #
    #     admin.site.register(xx, A)
    #     admin.site.register(xxx, B)
    #
    # 7 通过nginx调度放分django网站返回index.html或
    #     访问celery服务器返回index.html
    #
    #     设置
    #         网址 ---> django网站
    #         网址/index --> celery服务器
    #
    #     1 更改django index路由匹配
    #         url(r'^/index$')
    #
    #     2 部署 未完。。。。
    1

# 14 页面数据缓存

    把页面使用的数据存放在缓存中, 当再次使用这些数据时,
        先从缓存中获取,如果获取不到,再去查询数据库, 减少数据库查询的次数


    1 设置缓存
        from django.core.cache import cache

        class A(View):

            def get(self,request):

                尝试从缓存中获取数据
                context = cache.get('xxx')
                if context is None:


                    获取数据
                        ...
                    设置缓存
                    context = {"a":1, "b":2}
                    cache.set("aaaa", context, 3600) # 名称 缓存内容 过期时间

                return render(xxxx)